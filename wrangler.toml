name = "kids-reading-manager"
main = "src/worker.js"
compatibility_date = "2025-04-09"
compatibility_flags = ["nodejs_compat"]

# KV Namespace for storing application data (students, classes, settings, genres)
kv_namespaces = [
  { binding = "READING_MANAGER_KV", id = "09297a22cb3b4abc96bf0a5d4c79b4e9", preview_id = "6b452436a7794d36810e929dde07debf" },
  { binding = "RECOMMENDATIONS_CACHE", id = "PLACEHOLDER_CREATE_BEFORE_DEPLOY", preview_id = "PLACEHOLDER_CREATE_BEFORE_DEPLOY" }
]

# Email sending binding (requires Email Routing enabled on domain)
# Binding name "EMAIL_SENDER" will be available as env.EMAIL_SENDER in the worker
send_email = [
  { name = "EMAIL_SENDER" }
]

# Route configuration for custom domain
routes = [
  { pattern = "reading.brisflix.com/*", zone_name = "brisflix.com" }
]

# D1 Database for storing books (scalable SQL storage for large book collections)
[[d1_databases]]
binding = "READING_MANAGER_DB"
database_name = "reading-manager-db"
database_id = "30afac38-bccf-436b-8197-b59dabc73384"

# R2 bucket for caching book cover images
[[r2_buckets]]
binding = "BOOK_COVERS"
bucket_name = "book-covers"

# Configuration for serving static assets (React frontend)
[assets]
directory = "./build"
not_found_handling = "single-page-application"

# Environment variables
[vars]
ENVIRONMENT = "production"
STORAGE_TYPE = "kv"
ALLOWED_ORIGINS = "https://kids-reading-manager.brisflix.workers.dev/,https://reading.brisflix.com"
EMAIL_FROM = "noreply@brisflix.com"

[observability.logs]
enabled = true

# Cron triggers for scheduled tasks
# Runs daily at 2:00 AM UTC to recalculate all student streaks
[triggers]
crons = ["0 2 * * *"]
